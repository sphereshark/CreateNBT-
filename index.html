<!-- # CreateNBT- -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>WiiU NBT Builder</title>

<style>
body{font-family:sans-serif;background:#f5fbff;margin:20px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.row{display:flex;gap:8px;align-items:center;margin:6px 0}
input,select,button,textarea{border-radius:12px;border:1px solid #aaa;padding:6px 10px}
button{background:#dff3ff;cursor:pointer}
button.delete{background:#ffdede;border-color:#f99}
.item{border:2px solid #cce;border-radius:16px;padding:12px;margin:10px 0}
.editor{background:#eef;border-radius:12px;padding:8px;margin-top:6px}
.ench-row{display:flex;justify-content:space-between;align-items:center;background:#dde;border-radius:10px;padding:4px 8px;margin:4px 0}
textarea{width:100%;height:200px}
</style>
</head>

<body>

<h1>WiiU用 NBT簡易作成ツール</h1>

<div class="card">
<label><input type="radio" name="mode" value="menu" checked> クリエイティブメニュー</label>
</div>

<div id="menuPanel" class="card">
<select id="menuCat">
<option value="BuildingBlocks">建築ブロック</option>
<option value="Decorations">装飾</option>
<option value="Redstone">レッドストーン</option>
<option value="Transportation">乗り物</option>
<option value="Materials">材料</option>
<option value="Food">食料</option>
<option value="Tools_Wepons_and_Armor">道具・武器・防具</option>
<option value="Brewing">ポーション</option>
<option value="Brewing_1">ポーション ( 短い時間 )</option>
<option value="Brewing_2">ポーション ( 長い時間 )</option>
<option value="Brewing_3">ポーション ( レベル2 )</option>
<option value="Miscellaneous">その他</option>
</select>

<button onclick="addItem()">+ アイテム追加</button>
<div id="items"></div>
</div>

<div class="card">
<h2>出力</h2>
<textarea id="output"></textarea>
<button onclick="copyOut()">コピー</button>
</div>

<script>
/* ===================== 定数 ===================== */

const enchantList=[
 ['Enchantments_Protection','防護'],
 ['Enchantments_FireProtection','防火'],
 ['Enchantments_FeatherFalling','落下軽減'],
 ['Enchantments_BlastProtection','爆発耐性'],
 ['Enchantments_ProjectileProtection','間接攻撃耐性'],
 ['Enchantments_Respiration','水中呼吸'],
 ['Enchantments_AquaAffinity','水中作業'],
 ['Enchantments_Thorns','とげ'],
 ['Enchantments_DepthStrider','水中移動'],
 ['Enchantments_FrostWalker','氷渡り'],
 ['Enchantments_Curse_of_Binding','束縛の呪い'],
 ['Enchantments_Sharpness','鋭さ'],
 ['Enchantments_Smite','聖なる力'],
 ['Enchantments_Bane_of_Arthropods','虫殺し'],
 ['Enchantments_Knockback','ノックバック'],
 ['Enchantments_FireAspect','火属性'],
 ['Enchantments_Looting','アイテムボーナス'],
 ['Enchantments_Efficiency','効率'],
 ['Enchantments_SilkTouch','シルクタッチ'],
 ['Enchantments_Unbreaking','耐久力'],
 ['Enchantments_Fortune','幸運'],
 ['Enchantments_Power','射撃ダメージ'],
 ['Enchantments_Punch','衝撃'],
 ['Enchantments_Flame','火炎'],
 ['Enchantments_Infinity','無限'],
 ['Enchantments_Luck_of_the_Sea','宝釣り'],
 ['Enchantments_Lure','入れ食い'],
 ['Enchantments_Mending','修繕'],
 ['Enchantments_Curse_of_Vanishing','消滅の呪い'],
 ['Enchantments_Impaling','串刺し'],
 ['Enchantments_Riptide','激流'],
 ['Enchantments_Loyalty','忠誠心'],
 ['Enchantments_Channeling','チャネリング']
];

const attributeList=[
['AttributeModifiers_MaxHealth','最大HP'],
['AttributeModifiers_MobFollowRange','モブの追跡範囲'],
['AttributeModifiers_Knockbackresistance','ノックバック耐性'],
['AttributeModifiers_Speed','スピード'],
['AttributeModifiers_AttackDamage','攻撃力'],
['AttributeModifiers_HorseJumpStrength','馬の跳躍力'],
['AttributeModifiers_ZombieReinforcements','ゾンビの増援'],
['AttributeModifiers_AttackSpeed','攻撃速度'],
['AttributeModifiers_Armor','防具'],
['AttributeModifiers_ArmorUnbreakble','防具の耐久力'],
['AttributeModifiers_Lucky','幸運'],
['AttributeModifiers_Suuji','数字'],
['AttributeModifiers_Place','置く'],
['AttributeModifiers_Take','取る'],
['AttributeModifiers_Take_Place','取る/置く'],
['AttributeModifiers_ChangePose','ポーズを変更'],
['AttributeModifiers_Error','エラー'],
['AttributeModifiers_Bed_White','ベッド 白色'],
['AttributeModifiers_Bed_Orange','ベッド オレンジ色'],
['AttributeModifiers_Bed_Magenta','ベッド 赤紫'],
['AttributeModifiers_Bed_LightBlue','ベッド 空色'],
['AttributeModifiers_Bed_Yellow','ベッド 黄色'],
['AttributeModifiers_Bed_Lime','ベッド 黄緑'],
['AttributeModifiers_Bed_Pink','ベッド ピンク'],
['AttributeModifiers_Bed_Gray','ベッド 灰色'],
['AttributeModifiers_Bed_LightGray','ベッド 薄灰色'],
['AttributeModifiers_Bed_Cyan','ベッド 水色'],
['AttributeModifiers_Bed_Purple','ベッド 紫色'],
['AttributeModifiers_Bed_Blue','ベッド 青色'],
['AttributeModifiers_Bed_Brown','ベッド 茶色'],
['AttributeModifiers_Bed_Green','ベッド 緑色'],
['AttributeModifiers_Bed_Red','ベッド 赤色'],
['AttributeModifiers_Bed_Black','ベッド 黒色'],
['Fake_AttributeModifiers_MaxHealth','偽物 : 最大HP'],
['Fake_AttributeModifiers_MobFollowRange','偽物 : モブの追跡範囲'],
['Fake_AttributeModifiers_Knockbackresistance','偽物 : ノックバック耐性'],
['Fake_AttributeModifiers_Speed','偽物 : スピード'],
['Fake_AttributeModifiers_AttackDamage','偽物 : 攻撃力'],
['Fake_AttributeModifiers_HorseJumpStrength','偽物 : 馬の跳躍力'],
['Fake_AttributeModifiers_ZombieReinforcements','偽物 : ゾンビの増援'],
['Fake_AttributeModifiers_AttackSpeed','偽物 : 攻撃速度'],
['Fake_AttributeModifiers_Armor','偽物 : 防具'],
['Fake_AttributeModifiers_ArmorUnbreakble','偽物 : 防具の耐久力'],
['Fake_AttributeModifiers_Lucky','偽物 : 幸運']
];

const opeList=[
 ['Attribute_Operation_Default','デフォルト:0'],
 ['Attribute_Operation_Percent','パーセント:1']
];

// const amountCategory=[
//  'Infinity','Neg_Infinity','NaN'
// ];

/* ===================== データ ===================== */

let items=[];

/* ===================== 基本 ===================== */

function addItem(){
 items.push({
  pos:0,id:0,count:1,damage:0,
  enchants:[],
  attributes:[]
 });
 render();update();
}

function closeEditors(){
 document.querySelectorAll('.editor').forEach(e=>e.remove());
}

/* ===================== UI描画 ===================== */

function render(){
 const root=document.getElementById('items');
 root.innerHTML='';
 items.forEach((it,idx)=>{
  const box=document.createElement('div');
  box.className='item';
  box.innerHTML=`
   <div class="row">
    pos <input type=number value=${it.pos} onchange="items[${idx}].pos=this.value;update()">
    id <input type=number value=${it.id} onchange="items[${idx}].id=this.value;update()">
    count <input type=number value=${it.count} onchange="items[${idx}].count=this.value;update()">
    dmg <input type=number value=${it.damage} onchange="items[${idx}].damage=this.value;update()">
    <button class=delete onclick="items.splice(${idx},1);render();update()">削除</button>
   </div>

   <div class="row">
    <button onclick="openEnchant(${idx})">Enchant</button>
    <button onclick="openAttribute(${idx})">Attribute</button>
   </div>

   <div class="elist"></div>
  `;
  root.appendChild(box);
  renderLists(it,box);
 });
}

function renderLists(it,box){
 const el=box.querySelector('.elist');
 el.innerHTML='';

 it.enchants.forEach((e,i)=>{
  const d=document.createElement('div');
  d.className='ench-row';
  d.textContent=`${e.id} Lv${e.lv}`;
  const b=document.createElement('button');
  b.textContent='×';b.className='delete';
  b.onclick=()=>{it.enchants.splice(i,1);render();update()};
  d.appendChild(b);el.appendChild(d);
 });

 it.attributes.forEach((a,i)=>{
  const d=document.createElement('div');
  d.className='ench-row';
  d.textContent=`${a.id} / ${a.operation} / ${a.amount}`;
  const b=document.createElement('button');
  b.textContent='×';b.className='delete';
  b.onclick=()=>{it.attributes.splice(i,1);render();update()};
  d.appendChild(b);el.appendChild(d);
 });
}

/* ===================== Enchant ===================== */

function openEnchant(i){
 closeEditors();
 const w=document.createElement('div');
 w.className='editor';

 const sel=document.createElement('select');
 enchantList.forEach(e=>{
  const o=document.createElement('option');
  o.value=e[0];o.textContent=e[1];
  sel.appendChild(o);
 });

 const lv=document.createElement('input');
 lv.type='number';lv.value=0;

 const btn=document.createElement('button');
 btn.textContent='追加';
 btn.onclick=()=>{
  items[i].enchants.push({id:sel.value,lv:lv.value});
  render();update();
 };

 w.append('Enchant ',sel,' Lv ',lv,btn);
 document.getElementById('items').children[i].appendChild(w);
}

/* ===================== Attribute ===================== */

function openAttribute(i){
 closeEditors();
 const w=document.createElement('div');
 w.className='editor';

 const idSel=document.createElement('select');
 attributeList.forEach(a=>{
  const o=document.createElement('option');
  o.value=a[0];o.textContent=a[1];
  idSel.appendChild(o);
 });

 const opeSel=document.createElement('select');
 opeList.forEach(o=>{
  const op=document.createElement('option');
  op.value=o[0];op.textContent=o[1];
  opeSel.appendChild(op);
 });

 const amount=document.createElement('input');
 amount.placeholder='例: 0.1 / Infinity, Neg_Infinity, NaN';

 const btn=document.createElement('button');
 btn.textContent='追加';
 btn.onclick=()=>{
  items[i].attributes.push({
   id:idSel.value,
   operation:opeSel.value,
   amount:amount.value
  });
  render();update();
 };

 w.append(
  'Id ',idSel,
  ' Operation ',opeSel,
  ' Amount ',amount,
  btn
 );
 document.getElementById('items').children[i].appendChild(w);
}

/* ===================== Attribute Amount Formatter ===================== */

function formatAttributeAmount(v){
  // 特殊カテゴリはそのまま
  if(v === 'Infinity' || v === 'Neg_Infinity' || v === 'NaN'){
    return v;
  }

  // 数値なら db を付ける
  const n = Number(v);
  if(!isNaN(n)){
    if(String(v).includes('.')){
      return `${v}db`;
    }else{
      return `${v}.0db`;
    }
  }

  // 想定外入力（保険）
  return v;
}


/* ===================== NBT生成 ===================== */

function update(){
 let out='';
 items.forEach(it=>{
  out+='CompoundTag *tag = newTag();\n';

  if(it.enchants.length){
   out+='ListTag *listtag = newListTag();\n';
   it.enchants.forEach((e,i)=>{
    out+=`CompoundTag *enchtag${i} = newTag();\n`;
    out+=`NBT::Enchant(tag,listtag,enchtag${i},${e.id},${e.lv});\n`;
   });
  }

  if(it.attributes.length){
   out+='ListTag *AttributeModifiers = newListTag();\n';
   it.attributes.forEach((a,i)=>{
    out+=`CompoundTag *ability${i} = newTag();\n`;
    // out+=`NBT::Status(tag,AttributeModifiers,ability${i},${a.id}, ${a.operation}, ${a.amount}db);\n`;
    const amt = formatAttributeAmount(a.amount);
    out+=`NBT::Status(tag,AttributeModifiers,ability,${a.id}, ${a.operation}, ${amt});\n`;
   });
  }
  out+=`SetMenu(getMenuAddress(MenuCategory::${menuCat.value}),${it.pos},${it.id},${it.count},${it.damage},tag);\n\n`;
 });
 output.value=out;
}

function copyOut(){
 output.select();
 document.execCommand('copy');
}
</script>
</body>
</html>
